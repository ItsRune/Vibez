"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[250],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||o;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},71298:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_position:1},i=void 0,s={unversionedId:"Features/Ranking",id:"Features/Ranking",title:"Ranking",description:"Let's be honest, there's nothing worse than a potential future worker doing an application and not being automatically ranked by a system, days or even weeks of them spamming the group wall (or discord DMs) begging for their rank. This is why we have the ranking API. It allows you to rank workers in game without having to do it manually.",source:"@site/docs/Features/Ranking.md",sourceDirName:"Features",slug:"/Features/Ranking",permalink:"/VibezAPI/docs/Features/Ranking",draft:!1,editUrl:"https://github.com/ItsRune/VibezAPI/edit/master/docs/Features/Ranking.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"defaultSidebar",previous:{title:"Chainable",permalink:"/VibezAPI/docs/Chainable"},next:{title:"Activity Tracking",permalink:"/VibezAPI/docs/Features/Activity Tracking"}},l={},c=[{value:"How to use",id:"how-to-use",level:3},{value:"What&#39;s this <code>whoCalled</code> parameter?",id:"whats-this-whocalled-parameter",level:3},{value:"Why isn&#39;t it working?",id:"why-isnt-it-working",level:3},{value:"Examples",id:"examples",level:3}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Let's be honest, there's nothing worse than a potential future worker doing an application and not being automatically ranked by a system, days or even weeks of them spamming the group wall (or discord DMs) begging for their rank. This is why we have the ranking API. It allows you to rank workers in game without having to do it manually."),(0,r.kt)("h3",{id:"how-to-use"},"How to use"),(0,r.kt)("p",null,"At the moment there are only 4 ranking actions you can perform: ",(0,r.kt)("inlineCode",{parentName:"p"},"Promote"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Demote"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Fire"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"SetRank"),". Each of these actions have the same parameters, except for ",(0,r.kt)("inlineCode",{parentName:"p"},"SetRank")," which has an extra parameter. The parameters are as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"center"},"setRank Only"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"Player")),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"string")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"number")),(0,r.kt)("td",{parentName:"tr",align:"center"},"The user ID/Name of the worker you want to rank."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"Rank")),(0,r.kt)("td",{parentName:"tr",align:"center"},(0,r.kt)("inlineCode",{parentName:"td"},"string")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"number")),(0,r.kt)("td",{parentName:"tr",align:"center"},"The rank ID/Name/RoleId you want to rank the worker to."),(0,r.kt)("td",{parentName:"tr",align:"center"},"\u2714")))),(0,r.kt)("h3",{id:"whats-this-whocalled-parameter"},"What's this ",(0,r.kt)("inlineCode",{parentName:"h3"},"whoCalled")," parameter?"),(0,r.kt)("p",null,"Under the hood of the API, we use the ",(0,r.kt)("inlineCode",{parentName:"p"},"whoCalled")," parameter to generate logs within a Discord channel of the action, who did it, and who was affected. This is useful for auditing purposes, and to see who's abusing the API. If you supply nothing, the wrapper will automatically supply ",(0,r.kt)("strong",{parentName:"p"},"SYSTEM")," for the username, and the log generated will look different than with a proper user. If you supply a user's ID and name, the log will look like this:"),(0,r.kt)("img",{src:"/VibezAPI/rankingExampleWithUser.png"}),(0,r.kt)("p",null,"If you supply nothing, the log will look like this:"),(0,r.kt)("img",{src:"/VibezAPI/rankingExampleAutomatic.png"}),(0,r.kt)("h3",{id:"why-isnt-it-working"},"Why isn't it working?"),(0,r.kt)("p",null,"There's many reasons why the ranking API may fail, maybe your discord bot is offline, or maybe the worker is already ranked to the rank you're trying to rank them to. If you're having issues with the ranking API, please join our discord below and ask for help in the support channel."),(0,r.kt)("iframe",{src:"https://discord.com/widget?id=528920896497516554&theme=dark",width:"350",height:"500",allowtransparency:"true",frameborder:"0",sandbox:"allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"}),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"AutoRank Points"),(0,r.kt)("br",null),(0,r.kt)("p",null,"There's a chance this script may not work, as it's not tested. If you have any issues, please join our discord and ask for help in the support channel."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua",metastring:'title="ServerScriptService/autoRankPoints.server.lua"',title:'"ServerScriptService/autoRankPoints.server.lua"'},'--// Configuration \\\\--\nlocal apiKey = "API_KEY"\nlocal pointLocation = "(player).leaderstats.Points" -- Location of user\'s points\nlocal pointRanks = {\n    { Rank = 0, pointsRequired = 0 }\n}\n\n--// Services \\\\--\nlocal Players = game:GetService("Players")\nlocal ReplicatedStorage = game:GetService("ReplicatedStorage")\nlocal DataStoreService = game:GetService("DataStoreService")\n\n--// Variables \\\\--\nlocal vibezApi = require(14946453963)(apiKey, { Misc = { isAsync = true } })\nlocal dataStoreToUse = DataStoreService:GetDataStore("pointRanks_" .. game.PlaceId)\nlocal userCache = {}\n\n--// Functions \\\\--\nlocal function onPlayerAdded(Player: Player)\n    local isOk, data, connections, formattedString\n    \n    isOk, data = pcall(dataStoreToUse.GetAsync, dataStoreToUse, tostring(Player.UserId))\n    if not isOk then\n        return\n    end\n\n    data = data or {}\n    connections = {}\n\n    vibezApi = vibezApi:waitUntilLoaded()\n\n    -- Maybe I should explain what the 2 private methods do...\n    -- This one formats a string using specific variables which can be seen\n    -- on this page: https://itsrune.github.io/VibezAPI/docs/Settings#formatting-codes\n    formattedString = vibezApi:_fixFormattedString(pointLocation, Player)\n\n    -- This one loads the string into raw Lua code.\n    _, pointLocation = vibezApi:_Loadstring("return " .. formattedString)\n\n    if typeof(pointLocation) ~= "Instance" then\n        error("Invalid location of points for user " .. Player.Name)\n        return\n    end\n\n    table.insert(connections, pointLocation:GetPropertyChangedSignal("Value"):Connect(function()\n        for _, rankData in pairs(pointRanks) do\n            if\n                pointLocation.Value < rankData.pointsRequired\n                or data[rankData.Rank] == true\n            then\n                continue\n            end\n\n            local response = vibezApi:setRank(Player, rankData.Rank)\n\n            if response.Success then\n                data[rankData.Rank] = true\n            end\n        end\n    end))\n\n    userCache[Player.UserId] = {connections, data}\nend\n\nlocal function onPlayerLeft(Player: Player, retry: number?)\n    local exists = userCache[Player.UserId]\n    if not exists then\n        return\n    end\n\n    local isOk = pcall(dataStoreToUse.SetAsync, dataStoreToUse, tostring(Player.UserId), exists[2])\n    if not isOk then\n        retry = retry or 0\n        if retry > 3 then\n            error("Failed to save data for user " .. Player.Name)\n            return\n        end\n\n        task.wait(3)\n        return onPlayerLeft(Player, retry + 1)\n    end\n\n    for _, connection: RBXScriptConnection in pairs(exists[1]) do\n        connection:Disconnect()\n    end\n\n    userCache[Player.UserId] = nil\nend\n\n--// Events \\\\--\nPlayers.PlayerAdded:Connect(onPlayerAdded)\nPlayers.PlayerRemoving:Connect(onPlayerLeft)\n'))))}u.isMDXComponent=!0}}]);